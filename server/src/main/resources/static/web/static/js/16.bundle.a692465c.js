(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{707:function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"table-container"},[a("div",{staticClass:"toolbar"},[a("el-input",{attrs:{placeholder:"请输入内容"},model:{value:t.tableParams.parameter,callback:function(e){t.$set(t.tableParams,"parameter",e)},expression:"tableParams.parameter"}}),t._v(" "),a("el-button",{attrs:{icon:"el-icon-search"},on:{click:t.tableListGet}}),t._v(" "),a("div",{staticClass:"placeholder"}),t._v(" "),a("el-button",{attrs:{type:"danger",icon:"el-icon-delete"},on:{click:t.rowDelete}},[t._v("删除")]),t._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:t.rowAdd}},[t._v("添加专项任务")])],1),t._v(" "),a("div",{staticClass:"table"},[a("el-table",{attrs:{data:t.tableData},on:{"selection-change":t.tableSelectChange}},[a("el-table-column",{attrs:{type:"selection"}}),t._v(" "),a("el-table-column",{attrs:{prop:"taskName",label:"任务名称","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"provinceName",label:"巡检区域","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"startTime",formatter:t.timeShowFormat,label:"开始时间","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"endTime",formatter:t.timeShowFormat,label:"结束时间","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"taskType",label:"任务类型","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"巡检状态","min-width":"100",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{domProps:{innerHTML:t._s(t.renderState(e.row))}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"patrolName",label:"巡检人","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"150",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return t.rowDetail(e.row)}}},[t._v("详情")])]}}])})],1)],1),t._v(" "),a("div",{staticClass:"pagination"},[a("div",{staticClass:"placeholder"}),t._v(" "),a("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:t.tableTotal},on:{"current-change":t.tablePageChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:"添加",visible:t.visible.addDlg,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.visible,"addDlg",e)},opened:t.rowAddOpened}},[a("el-form",{ref:"addForm",attrs:{"label-width":"120px","label-position":"right",model:t.addForm,rules:t.rules,size:"mini"}},[a("el-form-item",{attrs:{prop:"taskName",label:"任务名称"}},[a("el-input",{model:{value:t.addForm.taskName,callback:function(e){t.$set(t.addForm,"taskName",e)},expression:"addForm.taskName"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"provinceId",label:"巡检省"}},[a("el-select",{model:{value:t.addForm.provinceId,callback:function(e){t.$set(t.addForm,"provinceId",e)},expression:"addForm.provinceId"}},t._l(t.locationPOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{prop:"roleId",label:"所属角色"}},[a("el-select",{attrs:{clearable:""},on:{change:t.personListGet},model:{value:t.addForm.roleId,callback:function(e){t.$set(t.addForm,"roleId",e)},expression:"addForm.roleId"}},t._l(t.roleOptions,function(t,e){return a("el-option",{key:e,attrs:{value:t.roleId,label:t.roleName}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{prop:"departmentId",label:"所属部门"}},[a("el-select",{attrs:{clearable:""},on:{change:t.personListGet},model:{value:t.addForm.departmentId,callback:function(e){t.$set(t.addForm,"departmentId",e)},expression:"addForm.departmentId"}},t._l(t.departmentOptions,function(t,e){return a("el-option",{key:e,attrs:{value:t.departmentId,label:t.departmentName}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{prop:"patrolId",label:"巡检人"}},[a("el-select",{attrs:{clearable:""},model:{value:t.addForm.patrolId,callback:function(e){t.$set(t.addForm,"patrolId",e)},expression:"addForm.patrolId"}},t._l(t.personOptions,function(t,e){return a("el-option",{key:e,attrs:{value:t.adminId,label:t.fullName}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"开始时间"}},[a("el-date-picker",{attrs:{disabled:""},model:{value:t.totalStartTime,callback:function(e){t.totalStartTime=e},expression:"totalStartTime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"结束时间"}},[a("el-date-picker",{attrs:{disabled:""},model:{value:t.totalEndTime,callback:function(e){t.totalEndTime=e},expression:"totalEndTime"}})],1)],1),t._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[a("span",{staticStyle:{"font-size":"1.4rem"}},[t._v("任务列表")])]),t._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{size:"mini"},on:{click:t.rowAddTask}},[t._v("添加")]),t._v(" "),a("el-table",{attrs:{data:t.addForm.listTSM}},[a("el-table-column",{attrs:{prop:"cityId",label:"巡检市","min-width":"100",align:"center",formatter:t.cityId2Name}}),t._v(" "),a("el-table-column",{attrs:{prop:"startTime",formatter:t.timeFormat,label:"巡检开始时间","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"endTime",formatter:t.timeFormat,label:"巡检结束时间","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"siteIds",label:"站点","min-width":"100",align:"center",formatter:t.siteId2Name}})],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible.addDlg=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.rowAddSubmit}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"添加",visible:t.visible.addTaskDlg,width:"30%","close-on-click-modal":!1,"append-to-body":""},on:{"update:visible":function(e){return t.$set(t.visible,"addTaskDlg",e)},opened:t.rowAddTaskOpened}},[a("el-form",{ref:"addTaskForm",attrs:{"label-width":"120px","label-position":"right",model:t.addTaskForm,rules:t.rulesTask,size:"mini"}},[a("el-form-item",{attrs:{prop:"cityId",label:"巡检市"}},[a("el-select",{model:{value:t.addTaskForm.cityId,callback:function(e){t.$set(t.addTaskForm,"cityId",e)},expression:"addTaskForm.cityId"}},t._l(t.locationCOptions,function(t,e){return a("el-option",{key:e,attrs:{label:t.name,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{prop:"startTime",label:"巡检开始时间"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"timestamp"},model:{value:t.addTaskForm.startTime,callback:function(e){t.$set(t.addTaskForm,"startTime",e)},expression:"addTaskForm.startTime"}})],1),t._v(" "),a("el-form-item",{attrs:{prop:"endTime",label:"巡检结束时间"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd","value-format":"timestamp"},model:{value:t.addTaskForm.endTime,callback:function(e){t.$set(t.addTaskForm,"endTime",e)},expression:"addTaskForm.endTime"}})],1),t._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[t._v("站点选择")]),t._v(" "),[a("el-transfer",{attrs:{data:t.deviceOptions,titles:["站点列表","已选站点"]},model:{value:t.addTaskForm.siteIds,callback:function(e){t.$set(t.addTaskForm,"siteIds",e)},expression:"addTaskForm.siteIds"}})]],2),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible.addTaskDlg=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.rowAddTaskSubmit}},[t._v("确 定")])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"详情",visible:t.visible.detailDlg,width:"50%","close-on-click-modal":!1},on:{"update:visible":function(e){return t.$set(t.visible,"detailDlg",e)}}},[a("el-form",{attrs:{"label-width":"120px","label-position":"right",size:"mini"}},[a("el-form-item",{attrs:{label:"任务名称"}},[a("el-input",{attrs:{disabled:""},model:{value:t.detailForm.taskName,callback:function(e){t.$set(t.detailForm,"taskName",e)},expression:"detailForm.taskName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"巡检省"}},[a("el-input",{attrs:{disabled:""},model:{value:t.detailForm.provinceName,callback:function(e){t.$set(t.detailForm,"provinceName",e)},expression:"detailForm.provinceName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"巡检人"}},[a("el-input",{attrs:{disabled:""},model:{value:t.detailForm.patrolName,callback:function(e){t.$set(t.detailForm,"patrolName",e)},expression:"detailForm.patrolName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"开始时间"}},[a("el-date-picker",{attrs:{disabled:""},model:{value:t.detailForm.startTime,callback:function(e){t.$set(t.detailForm,"startTime",e)},expression:"detailForm.startTime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"结束时间"}},[a("el-date-picker",{attrs:{disabled:""},model:{value:t.detailForm.endTime,callback:function(e){t.$set(t.detailForm,"endTime",e)},expression:"detailForm.endTime"}})],1)],1),t._v(" "),a("el-divider",{attrs:{"content-position":"left"}},[a("span",{staticStyle:{"font-size":"1.4rem"}},[t._v("任务列表")])]),t._v(" "),a("el-table",{attrs:{data:t.detailForm.listTSM}},[a("el-table-column",{attrs:{prop:"siteCityName",label:"巡检市","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"startTime",formatter:t.timeShowFormat,label:"巡检开始时间","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"endTime",formatter:t.timeShowFormat,label:"巡检结束时间","min-width":"100",align:"center"}}),t._v(" "),a("el-table-column",{attrs:{prop:"siteName",label:"站点","min-width":"100",align:"center"}})],1),t._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.visible.detailDlg=!1}}},[t._v("关 闭")])],1)],1)],1)};l._withStripped=!0;var i={data:function(){return{tableData:null,tableParams:{parameter:null},tablePage:1,tableTotal:1,sels:[],visible:{addDlg:!1,addTaskDlg:!1,detailDlg:!1,imgView:!1,deviceDetail:!1},rules:{taskName:[{required:!0,message:"请输入",trigger:"blur"}],provinceId:[{required:!0,message:"请输入",trigger:"change"}],patrolId:[{required:!1}]},rulesTask:{cityId:[{required:!0,message:"请输入",trigger:"blur"}],startTime:[{required:!0,message:"请输入",trigger:"blur"}],endTime:[{required:!0,message:"请输入",trigger:"blur"}]},addForm:{taskName:null,provinceId:0,patrolId:null,roleId:null,departmentId:null,listTSM:[]},detailForm:{taskName:null,provinceName:0,patrolName:null,listTSM:[]},addTaskForm:{cityId:0,startTime:null,endTime:null,siteIds:[]},departmentOptions:[],roleOptions:[{roleName:"员工",roleId:29},{roleName:"代维1级",roleId:30},{roleName:"代维2级",roleId:31},{roleName:"办事处员工",roleId:34}],personOptions:[],deviceOptions:[],locationPOptions:[],locationCOptions:[],cityIndex:{},siteIndex:{}}},computed:{totalStartTime:function(){var t=null,e=this.addForm.listTSM;if(0===e.length)return null;for(var a in t=this.addForm.listTSM[0].startTime,e)e[a].startTime<t&&(t=e[a].startTime);return t},totalEndTime:function(){var t=null,e=this.addForm.listTSM;if(0===e.length)return null;for(var a in t=this.addForm.listTSM[0].endTime,e)e[a].endTime>t&&(t=e[a].endTime);return t}},methods:{tableListGet:function(){var t=this;this.$API.TaskGet(this.tableParams.parameter?this.tableParams:null,this.tablePage).then(function(e){t.tableData=e.records,t.tableTotal=e.total})},personListGet:function(){var t=this;this.personOptions=[],this.addForm.patrolId=null,this.$API.PersonGet(null,this.addForm.roleId||0,this.addForm.departmentId||0).then(function(e){t.personOptions=e})},rowAdd:function(){var t=this;for(var e in this.addForm)this.addForm[e]="listTSM"==e?[]:null;this.$API.LocationGetP().then(function(e){t.locationPOptions=e}),this.$API.DepartmentGet().then(function(e){t.departmentOptions=e}),this.visible.addDlg=!0},rowAddOpened:function(){this.$refs.addForm.resetFields()},rowAddSubmit:function(){var t=this;0!==this.addForm.listTSM.length?this.$refs.addForm.validate(function(e){if(e){var a={taskName:t.addForm.taskName,provinceId:t.addForm.provinceId,patrolId:t.addForm.patrolId,taskType:"专项任务",startTime:t.timeFormat(null,null,t.totalStartTime)+" 12:00:00",endTime:t.timeFormat(null,null,t.totalEndTime)+" 12:00:00",listTSM:[]};for(var l in t.addForm.listTSM)for(var i in t.addForm.listTSM[l].siteIds)a.listTSM.push({cityId:t.addForm.listTSM[l].cityId,startTime:t.addForm.listTSM[l].startTime,endTime:t.addForm.listTSM[l].endTime,siteId:t.addForm.listTSM[l].siteIds[i]});for(var r in a.listTSM)a.listTSM[r].startTime=t.timeFormat(null,null,a.listTSM[r].startTime)+" 12:00:00",a.listTSM[r].endTime=t.timeFormat(null,null,a.listTSM[r].endTime)+" 12:00:00";t.$API.TaskAdd(a).then(function(){t.tableListGet(),t.visible.addDlg=!1})}}):this.$message({message:"最少添加一个站点",type:"warning"})},rowAddTask:function(){var t=this;this.$refs.addForm.validate(function(e){if(e){for(var a in t.addTaskForm)t.addTaskForm[a]="siteIds"==a?[]:null;t.$API.DeviceSiteGet(null,0,t.addForm.provinceId||0,t.addForm.cityId||0).then(function(e){if(t.siteIndex={},0!==e.length)for(var a in t.deviceOptions=[],e)t.siteIndex[e[a].siteId]=e[a].siteName,t.deviceOptions.push({key:e[a].siteId,label:e[a].siteName})});var l={pid:t.addForm.provinceId||0};t.$API.LocationGetC(l).then(function(e){if(t.locationCOptions=e,t.cityIndex={},0!==e.length)for(var a in e)t.cityIndex[e[a].id]=e[a].name}),t.visible.addTaskDlg=!0}})},rowAddTaskOpened:function(){this.$refs.addTaskForm.resetFields()},rowAddTaskSubmit:function(){var t=this;0!==this.addTaskForm.siteIds.length?this.$refs.addTaskForm.validate(function(e){e&&(t.addForm.listTSM.push(JSON.parse(JSON.stringify(t.addTaskForm))),t.visible.addTaskDlg=!1)}):this.$message({message:"最少选择一个站点",type:"warning"})},rowDetail:function(t){this.detailForm=t,this.visible.detailDlg=!0},rowDelete:function(){var t=this;0!==this.sels.length&&this.$confirm("确认删除这些数据？","提示",{type:"warning"}).then(function(){t.$API.TaskDelete(t.sels.map(function(t){return t.patrolTaskProvinceId})).then(function(){t.tableListGet()})}).catch()},cityId2Name:function(t,e,a,l){return this.cityIndex[a]},siteId2Name:function(t,e,a,l){var i=this;return a.map(function(t){return i.siteIndex[t]}).join(",")},timeFormat:function(t,e,a,l){var i=new Date;return i.setTime(a),this.$format(i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate())},timeShowFormat:function(t,e,a,l){return this.$format(a)},tablePageChange:function(t){this.tablePage=t,this.tableListGet()},tableSelectChange:function(t){this.sels=t},renderState:function(t){var e=new Date(t.startTime.replace(/-/g,"/")),a=new Date(t.endTime.replace(/-/g,"/")),l=new Date,i="";return e<l&&"未开始"==t.patrolState||a<l&&"正在巡查"==t.patrolState?i="#F56C6C":"未开始"==t.patrolState?i="#303133":"正在巡查"==t.patrolState?i="#409EFF":"已完成"==t.patrolState&&(i="#67C23A"),'<div style="color:'+i+'">'+t.patrolState+"</div>"}},mounted:function(){this.tableListGet()}},r=a(8),o=Object(r.a)(i,l,[],!1,null,null,null);o.options.__file="src/views/Inspection/Task.vue";e.default=o.exports}}]);