(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{709:function(e,t,i){"use strict";i.r(t);var l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticClass:"table-container"},[i("div",{staticClass:"toolbar"},[i("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.tableParams.parameter,callback:function(t){e.$set(e.tableParams,"parameter",t)},expression:"tableParams.parameter"}}),e._v(" "),i("el-button",{attrs:{icon:"el-icon-search"},on:{click:e.tableListGet}}),e._v(" "),i("div",{staticClass:"placeholder"}),e._v(" "),i("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.rowAdd}},[e._v("添加")])],1),e._v(" "),i("div",{staticClass:"table"},[i("el-table",{attrs:{data:e.tableData}},[i("el-table-column",{attrs:{prop:"deviceSystemNum",label:"子系统号","min-width":"100",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"deviceName",label:"设备名称","min-width":"100",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"deviceModel",label:"设备型号","min-width":"100",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"deviceSerialNum",label:"设备序号","min-width":"100",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"deviceState",label:"设备状态","min-width":"100",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{prop:"siteName",label:"所属台站","min-width":"100",align:"center"}}),e._v(" "),i("el-table-column",{attrs:{label:"设备照片","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.rowPcitureDetail(t.row)}}},[e._v("详情")])]}}])}),e._v(" "),i("el-table-column",{attrs:{label:"设备详情","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{type:"text"},on:{click:function(i){return e.rowEdit(t.row)}}},[e._v("详情")])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"",label:"操作",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{staticStyle:{color:"#F56C6C"},attrs:{type:"text"},on:{click:function(i){return e.rowDelete(t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),i("div",{staticClass:"pagination"},[i("div",{staticClass:"placeholder"}),e._v(" "),i("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.tableTotal},on:{"current-change":e.tablePageChange}})],1),e._v(" "),i("el-dialog",{attrs:{title:"添加",visible:e.visible.addDlg,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.visible,"addDlg",t)},opened:e.rowAddOpened}},[i("el-form",{ref:"addForm",attrs:{"label-width":"120px","label-position":"right",model:e.addForm,rules:e.rules,size:"mini"}},[i("el-form-item",{attrs:{prop:"deviceName",label:"设备名称"}},[i("el-input",{model:{value:e.addForm.deviceName,callback:function(t){e.$set(e.addForm,"deviceName",t)},expression:"addForm.deviceName"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"area",label:"所属区域"}},[i("el-cascader",{attrs:{options:e.locationOptions,props:e.locationProps,"change-on-select":"",placeholder:"请选择"},on:{change:e.siteListAddGet},model:{value:e.addForm.area,callback:function(t){e.$set(e.addForm,"area",t)},expression:"addForm.area"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"siteId",label:"所属站点"}},[i("el-select",{model:{value:e.addForm.siteId,callback:function(t){e.$set(e.addForm,"siteId",t)},expression:"addForm.siteId"}},e._l(e.siteOptions,function(e,t){return i("el-option",{key:t,attrs:{value:e.siteId,label:e.siteName}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{prop:"deviceSystemNum",label:"子系统号"}},[i("el-input",{model:{value:e.addForm.deviceSystemNum,callback:function(t){e.$set(e.addForm,"deviceSystemNum",t)},expression:"addForm.deviceSystemNum"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"deviceModel",label:"设备型号"}},[i("el-input",{model:{value:e.addForm.deviceModel,callback:function(t){e.$set(e.addForm,"deviceModel",t)},expression:"addForm.deviceModel"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"deviceSerialNum",label:"设备序号"}},[i("el-input",{model:{value:e.addForm.deviceSerialNum,callback:function(t){e.$set(e.addForm,"deviceSerialNum",t)},expression:"addForm.deviceSerialNum"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"设备照片"}},[i("el-upload",{attrs:{action:"","auto-upload":!1,"list-type":"picture",limit:8,"on-change":e.onChange,"on-remove":e.onRemove,"on-exceed":e.onExceed,accept:".jpg,.png",multiple:""}},[i("el-button",{attrs:{slot:"trigger",size:"small"},slot:"trigger"},[e._v("添加图片")]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过8张")])],1)],1),e._v(" "),i("el-form-item",{attrs:{prop:"deviceDescribe",label:"设备描述"}},[i("el-input",{attrs:{type:"textarea",maxlength:"9999","show-word-limit":""},model:{value:e.addForm.deviceDescribe,callback:function(t){e.$set(e.addForm,"deviceDescribe",t)},expression:"addForm.deviceDescribe"}})],1)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.visible.addDlg=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.rowAddSubmit}},[e._v("确 定")])],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"编辑",visible:e.visible.editDlg,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.visible,"editDlg",t)},close:e.clearEditData}},[i("el-form",{ref:"editForm",attrs:{"label-width":"120px","label-position":"right",model:e.editForm,rules:e.rules,size:"mini"}},[i("el-form-item",{attrs:{prop:"deviceName",label:"设备名称"}},[i("el-input",{model:{value:e.editForm.deviceName,callback:function(t){e.$set(e.editForm,"deviceName",t)},expression:"editForm.deviceName"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"area",label:"所属区域"}},[i("el-cascader",{attrs:{options:e.locationOptions,props:e.locationProps,"change-on-select":"",placeholder:"请选择"},on:{change:e.siteListEditGet},model:{value:e.editForm.area,callback:function(t){e.$set(e.editForm,"area",t)},expression:"editForm.area"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"siteId",label:"所属站点"}},[i("el-select",{model:{value:e.editForm.siteId,callback:function(t){e.$set(e.editForm,"siteId",t)},expression:"editForm.siteId"}},e._l(e.siteOptions,function(e,t){return i("el-option",{key:t,attrs:{value:e.siteId,label:e.siteName}})}),1)],1),e._v(" "),i("el-form-item",{attrs:{prop:"deviceSystemNum",label:"子系统号"}},[i("el-input",{model:{value:e.editForm.deviceSystemNum,callback:function(t){e.$set(e.editForm,"deviceSystemNum",t)},expression:"editForm.deviceSystemNum"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"deviceModel",label:"设备型号"}},[i("el-input",{model:{value:e.editForm.deviceModel,callback:function(t){e.$set(e.editForm,"deviceModel",t)},expression:"editForm.deviceModel"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"deviceSerialNum",label:"设备序号"}},[i("el-input",{model:{value:e.editForm.deviceSerialNum,callback:function(t){e.$set(e.editForm,"deviceSerialNum",t)},expression:"editForm.deviceSerialNum"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"设备照片"}},[i("el-upload",{attrs:{action:"","auto-upload":!1,"list-type":"picture",limit:8,"on-change":e.onEditChange,"before-remove":e.beforeEditRemove,"on-remove":e.onEditRemove,accept:".jpg,.png","file-list":e.editForm.imgList,"on-exceed":e.onExceed,multiple:""}},[i("el-button",{attrs:{slot:"trigger",size:"small"},slot:"trigger"},[e._v("添加图片")]),e._v(" "),i("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，且不超过8张")])],1)],1),e._v(" "),i("el-form-item",{attrs:{prop:"deviceDescribe",label:"设备描述"}},[i("el-input",{attrs:{type:"textarea",maxlength:"9999","show-word-limit":""},model:{value:e.editForm.deviceDescribe,callback:function(t){e.$set(e.editForm,"deviceDescribe",t)},expression:"editForm.deviceDescribe"}})],1)],1),e._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.visible.editDlg=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.rowEditSubmit}},[e._v("确 定")])],1)],1),e._v(" "),i("z-img-view",{attrs:{imgs:e.fileList,visible:e.visible.pictureDetail},on:{"update:visible":function(t){return e.$set(e.visible,"pictureDetail",t)}}})],1)};function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}l._withStripped=!0;var r={data:function(){return{tableData:null,tableParams:{parameter:null},tablePage:1,tableTotal:1,visible:{addDlg:!1,editDlg:!1,pictureDetail:!1},rules:{deviceName:[{required:!0,message:"请输入",trigger:"blur"}],area:[{required:!0,message:"请输入",trigger:"blur"}],siteId:[{required:!0,message:"请输入",trigger:"blur"}],deviceSystemNum:[{required:!0,message:"请输入",trigger:"blur"}],deviceModel:[{required:!0,message:"请输入",trigger:"blur"}],deviceSerialNum:[{required:!0,message:"请输入",trigger:"blur"}],deviceDescribe:[{required:!0,message:"请输入",trigger:"blur"}]},addForm:{deviceName:null,area:[],siteId:null,deviceSystemNum:null,deviceModel:null,deviceSerialNum:null,imgList:[],deviceDescribe:null},editForm:{deviceId:null,deviceName:null,area:[],siteId:null,deviceSystemNum:null,deviceModel:null,deviceSerialNum:null,imgList:[],deviceDescribe:null},imgListBin:[],locationOptions:[],siteOptions:[],locationProps:{value:"id",label:"name",children:"child"},fileList:[]}},methods:{tableListGet:function(){var e=this;this.$API.DeviceInfoGet(this.tableParams.parameter?this.tableParams:null,this.tablePage).then(function(t){e.tableData=t.records,e.tableTotal=t.total})},rowAdd:function(){var e=this;this.$API.LocationGet().then(function(t){e.locationOptions=t}),this.visible.addDlg=!0},rowAddOpened:function(){this.$refs.addForm.resetFields(),this.imgListBin=[]},rowAddSubmit:function(){var e=this,t={deviceName:this.addForm.deviceName||null,siteId:this.addForm.siteId||null,deviceSystemNum:this.addForm.deviceSystemNum||null,deviceModel:this.addForm.deviceModel||null,deviceSerialNum:this.addForm.deviceSerialNum||null,deviceDescribe:this.addForm.deviceDescribe||null,imgList:[]};this.imgListBin.length<=0?this.$message({message:"请至少选择一张图片",type:"warning"}):this.$refs.addForm.validate(function(i){if(i){var l=new FormData;for(var a in e.imgListBin)l.append("multipartFiles",e.imgListBin[a]);e.$API.Uploads(l).then(function(i){t.imgList=i.map(function(e){return{resourceUrl:e}}),e.$API.DeviceInfoAdd(t).then(function(){e.tableListGet(),e.visible.addDlg=!1})})}})},rowEdit:function(e){var t=this;for(var i in this.editForm)this.editForm[i]="imgList"==i||"area"==i?[]:null;this.$API.LocationGet().then(function(e){t.locationOptions=e}),this.$API.DeviceInfoGetById(null,e.deviceId).then(function(e){t.editForm.deviceId=e.deviceId||null,t.editForm.deviceName=e.deviceName||null,t.editForm.area=[e.siteProvinceId||null,e.siteCityId||null],t.editForm.siteId=e.siteId||null,t.editForm.deviceSystemNum=e.deviceSystemNum||null,t.editForm.deviceModel=e.deviceModel||null,t.editForm.deviceSerialNum=e.deviceSerialNum||null,t.editForm.deviceDescribe=e.deviceDescribe||null,t.editForm.imgList=e.imgList.map(function(e){return{name:e.resourceId,url:e.resourceUrl}})}),this.imgListBin=[],this.visible.editDlg=!0},rowEditSubmit:function(){var e,t=this,i=(a(e={deviceId:this.editForm.deviceId||null,siteId:this.editForm.siteId||null,deviceName:this.editForm.deviceName||null},"siteId",this.editForm.siteId||null),a(e,"deviceSystemNum",this.editForm.deviceSystemNum||null),a(e,"deviceModel",this.editForm.deviceModel||null),a(e,"deviceSerialNum",this.editForm.deviceSerialNum||null),a(e,"imgList",[]),e);this.editForm.imgList.length+this.imgListBin.length<=0?this.$message({message:"请至少选择一张图片",type:"warning"}):this.$refs.editForm.validate(function(e){if(e){var l=new FormData;for(var a in t.imgListBin)l.append("multipartFiles",t.imgListBin[a]);t.$API.Uploads(l).then(function(e){i.imgList=e.map(function(e){return{resourceUrl:e}}),t.$API.DeviceInfoEdit(i).then(function(){t.tableListGet(),t.visible.editDlg=!1})})}})},siteListAddGet:function(){var e=this;this.$API.DeviceSiteGet(null,0,this.addForm.area[0]||0,this.addForm.area[1]||0).then(function(t){e.siteOptions=t})},siteListEditGet:function(){var e=this;this.$API.DeviceSiteGet(null,0,this.editForm.area[0]||0,this.editForm.area[1]||0).then(function(t){e.siteOptions=t})},rowPcitureDetail:function(e){this.fileList=e.imgList.map(function(e){return e.resourceUrl}),this.visible.pictureDetail=!0},rowDelete:function(e){var t=this;this.$confirm("确认删除该条数据？","提示",{type:"warning"}).then(function(){t.$API.DeviceInfoDelete(null,e.deviceId).then(function(){t.tableListGet()})}).catch()},tablePageChange:function(e){this.tablePage=e,this.tableListGet()},onExceed:function(){this.$message({message:"图片数不超过8张",type:"warning"})},onChange:function(e,t){this.imgListBin=t.map(function(e){return e.raw})},onRemove:function(e,t){this.imgListBin=t.map(function(e){return e.raw})},onEditChange:function(e,t){this.imgListBin=t.filter(function(e){return e.raw}).map(function(e){return e.raw})},beforeEditRemove:function(e,t){var i=this;return"success"==e.status?this.$confirm("确认删除该图片？","提示",{type:"warning"}).then(function(){i.$API.DeviceInfoImgDelete(null,e.name).then(function(e){i.$message({message:"删除成功",type:"success"})}).catch(function(e){i.$message({message:"删除失败",type:"error"})})}):"ready"==e.status},onEditRemove:function(e,t){this.editForm.imgList=t,this.imgListBin=t.filter(function(e){return e.raw}).map(function(e){return e.raw})},clearAddData:function(){for(var e in this.addForm)this.addForm[e]="imgList"==e||"area"==e?[]:null},clearEditData:function(){for(var e in this.editForm)this.editForm[e]="imgList"==e||"area"==e?[]:null}},mounted:function(){this.$route.params.id&&alert("参数"+this.$route.params.id),this.tableListGet()}},o=i(8),n=Object(o.a)(r,l,[],!1,null,null,null);n.options.__file="src/views/Site/DeviceInfo.vue";t.default=n.exports}}]);