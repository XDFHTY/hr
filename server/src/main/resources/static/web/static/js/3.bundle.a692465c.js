(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{281:function(e,t,i){},671:function(e,t,i){e.exports=i.p+"static/img/map_point_1.f45ab5ef.png"},672:function(e,t,i){e.exports=i.p+"static/img/map_point_2.800a8511.png"},673:function(e,t,i){e.exports=i.p+"static/img/map_point_3.1894b70f.png"},674:function(e,t,i){"use strict";var a=i(281);i.n(a).a},711:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("section",{staticStyle:{height:"100%"}},[i("div",{attrs:{id:"map"}}),e._v(" "),i("div",{attrs:{id:"ctrlBar"}},[i("el-cascader",{attrs:{options:e.locationOptions,props:e.locationProps,"change-on-select":"",clearable:"",placeholder:"请选择",size:"mini",disabled:e.isLimit},on:{change:e.areaSelectChange},model:{value:e.tableParams.area,callback:function(t){e.$set(e.tableParams,"area",t)},expression:"tableParams.area"}}),e._v(" "),i("el-button",{attrs:{circle:"",size:"mini",icon:"el-icon-search"},on:{click:e.areaSearch}}),e._v(" "),e._m(0),e._v(" "),i("el-switch",{staticStyle:{margin:"0 3px 0 10px"},attrs:{"active-color":"#13ce66","inactive-color":"rgba(50,50,50,0.5)"},model:{value:e.isSatellite,callback:function(t){e.isSatellite=t},expression:"isSatellite"}})],1),e._v(" "),i("div",{attrs:{id:"infoPanel"}},[i("div",{attrs:{id:"siteInfo"}},[i("div",{staticStyle:{color:"#67C23A"}},[e._v("正常站点："+e._s(e.siteState.normalNmu))]),e._v(" "),i("div",{staticStyle:{color:"#F56C6C"}},[e._v("异常站点："+e._s(e.siteState.abnormalNum))]),e._v(" "),i("div",{staticStyle:{color:"#409EFF"}},[e._v("维护站点："+e._s(e.siteState.maintainNum))])])]),e._v(" "),i("div",{attrs:{id:"infoPanelAfter"},on:{click:function(t){e.isPie=!e.isPie}}},[e.isPie?i("i",{staticClass:"el-icon-arrow-up"}):i("i",{staticClass:"el-icon-arrow-down"})]),e._v(" "),i("el-collapse-transition",[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isPie,expression:"isPie"}],attrs:{id:"piePanel"}},[i("div",{ref:"chart",staticStyle:{width:"500px",height:"250px"}})])])],1)};a._withStripped=!0;var n=i(213),s=i.n(n),o=i(671),r=i.n(o),l=i(672),c=i.n(l),m=i(673),d=i.n(m),p=null,h=null,u=null,v=null,f=[],S={data:function(){return{siteData:null,siteOptions:[],siteState:{normalNmu:0,abnormalNum:0,maintainNum:0,siteTotal:0},tableParams:{area:[],provinceId:0,cityId:0,siteType:0},locationOptions:[],locationIndex:{},locationProps:{value:"id",label:"name",children:"child"},isSatellite:!1,isPie:!1,isLimit:!0}},computed:{},watch:{isSatellite:function(){this.isSatellite?p.add(u):p.remove(u)}},methods:{areaSearch:function(){var e=this;if(0!==this.tableParams.cityId){var t=this.locationIndex[this.tableParams.cityId];/市$/.test(t)?p.setCity(this.locationIndex[this.tableParams.cityId]):p.setCity(this.locationIndex[this.tableParams.provinceId]),this.$API.MapSiteGet(null,this.tableParams.provinceId,this.tableParams.cityId,this.tableParams.siteType).then(function(t){e.siteState=t.siteState,e.siteData=t.sites,e.createMapElements(t.sites),e.showChart(),e.isPie=!0})}else 0!==this.tableParams.provinceId?(p.setCity(this.locationIndex[this.tableParams.provinceId]),this.$API.MapSiteGet(null,this.tableParams.provinceId,0,this.tableParams.siteType).then(function(t){e.siteState=t.siteState,e.siteData=t.sites,e.createMapElements(t.sites),e.showChart(),e.isPie=!0})):this.$message({message:"请先选择地区",type:"warning"})},showChart:function(){var e=s.a.init(this.$refs.chart),t=[],i=[];0!=this.siteState.normalNmu&&(t.push("正常站点"),i.push({name:"正常站点",value:this.siteState.normalNmu,itemStyle:{color:"#67C23A"}})),0!=this.siteState.abnormalNum&&(t.push("异常站点"),i.push({name:"异常站点",value:this.siteState.abnormalNum,itemStyle:{color:"#F56C6C"}})),0!=this.siteState.maintainNum&&(t.push("维护站点"),i.push({name:"维护站点",value:this.siteState.maintainNum,itemStyle:{color:"#409EFF"}})),e.setOption({tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},series:[{name:"数量",type:"pie",data:i,center:["40%","50%"],radius:["0","60%"],label:{formatter:"{b}({d}%)"},itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]})},areaSelectChange:function(e){this.tableParams.provinceId=e[0]||0,this.tableParams.cityId=e[1]||0},createLocationIndex:function(e){for(var t in e)e[t].child?(this.locationIndex[e[t].id]=e[t].name,this.createLocationIndex(e[t].child)):this.locationIndex[e[t].id]=e[t].name},markerClick:function(e){h.setContent(e.target.content),h.open(p,e.target.getPosition());var t=new AMap.Icon({size:new AMap.Size(28,36),image:e.target.getIcon().B.image,imageSize:new AMap.Size(28,36)});v.eachOverlay(function(e,t,i){var a=new AMap.Icon({size:new AMap.Size(21,27),image:e.getIcon().B.image,imageSize:new AMap.Size(21,27)});e.setIcon(a)}),e.target.setIcon(t)},createMapElements:function(e){p.clearMap();var t=!0,i=!1,a=void 0;try{for(var n,s=e[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var o=n.value;if(!o.siteLongitude||!o.siteLatitude){console.warn("无坐标");break}var l=[o.siteLongitude,o.siteLatitude],m=0!=o.imgList.length?o.imgList[0].resourceUrl:"",h=null;h=1==o.siteSaleState?r.a:2==o.siteSaleState?c.a:d.a;var u=new AMap.Icon({size:new AMap.Size(21,27),image:h,imageSize:new AMap.Size(21,27)}),S=new AMap.Marker({position:l,map:p,icon:u,label:{offset:new AMap.Pixel(10,0),content:o.siteName,direction:"right"}});S.content='<div class="infowindow" id="infowindow"><div class="site-info"><div>台站名称：'+o.siteName+"</div><div>台站编号："+o.siteNum+"</div><div>台站地址："+o.provinceName+o.cityName+"</div><div>台站经度："+o.siteLongitude+"</div><div>台站纬度："+o.siteLatitude+'</div></div><div class="imgbox"><img src="'+m+'"></div><a href="/#/site/siteInfo/'+o.siteId+'"><i class="el-icon-right"></i></a></div>',S.on("click",this.markerClick),f.push(S)}}catch(e){i=!0,a=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw a}}v=new AMap.OverlayGroup(f),p.getZoom()>8?v.show():v.hide()}},mounted:function(){var e=this;this.$API.LocationGet().then(function(t){e.locationOptions=t,e.createLocationIndex(t);var i=JSON.parse(sessionStorage.getItem("adminInfo"));0!==i.cityId?(e.tableParams.provinceId=i.provinceId,e.tableParams.cityId=i.cityId,e.tableParams.area=[i.provinceId,i.cityId],e.isLimit=!0,e.areaSearch()):0===i.cityId&&0!==i.provinceId?(e.tableParams.provinceId=i.provinceId,e.tableParams.cityId=0,e.tableParams.area=[i.provinceId,0],e.isLimit=!0,e.areaSearch()):e.isLimit=!1}),p=new AMap.Map("map",{resizeEnable:!0,zoom:7,center:[116.397428,39.90923]}),h=new AMap.InfoWindow({offset:new AMap.Pixel(0,-30)}),u=new AMap.TileLayer.Satellite,h.on("close",function(){v.eachOverlay(function(e,t,i){var a=new AMap.Icon({size:new AMap.Size(21,27),image:e.getIcon().B.image,imageSize:new AMap.Size(21,27)});e.setIcon(a)})}),p.on("zoomend",function(){p.getZoom()>8?v&&v.show():(v&&v.hide(),h&&h.close())})}},I=(i(674),i(8)),g=Object(I.a)(S,a,[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{flex:"auto","border-left":"1px solid white",height:"80%",width:"2px"}},[t("br")])}],!1,null,null,null);g.options.__file="src/views/Map/Map.vue";t.default=g.exports}}]);