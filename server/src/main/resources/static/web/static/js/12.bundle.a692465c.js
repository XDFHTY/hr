(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{705:function(e,t,l){"use strict";l.r(t);var a=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("section",[l("div",{staticClass:"toolbar"},[l("el-input",{attrs:{placeholder:"请输入内容"},model:{value:e.tableParams.parameter,callback:function(t){e.$set(e.tableParams,"parameter",t)},expression:"tableParams.parameter"}}),e._v(" "),l("el-button",{attrs:{icon:"el-icon-search"},on:{click:e.tableListGet}}),e._v(" "),l("div",{staticClass:"placeholder"}),e._v(" "),l("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.rowAdd}},[e._v("添加")])],1),e._v(" "),l("div",{staticClass:"table"},[l("el-table",{attrs:{data:e.tableData}},[l("el-table-column",{attrs:{prop:"declareId",label:"单号","min-width":"100",align:"center"}}),e._v(" "),l("el-table-column",{attrs:{prop:"founderName",label:"申报人","min-width":"100",align:"center"}}),e._v(" "),l("el-table-column",{attrs:{prop:"roleName",label:"角色","Declare.vuemin-width":"100",align:"center"}}),e._v(" "),l("el-table-column",{attrs:{prop:"contactsName",label:"联系人","min-width":"100",align:"center"}}),e._v(" "),l("el-table-column",{attrs:{prop:"phone",label:"电话号码","min-width":"100",align:"center"}}),e._v(" "),l("el-table-column",{attrs:{prop:"createTime",label:"申报时间","min-width":"100",formatter:e.dateFormat,align:"center"}}),e._v(" "),l("el-table-column",{attrs:{prop:"declareType",label:"问题类型","min-width":"100",align:"center"}}),e._v(" "),l("el-table-column",{attrs:{label:"保修状态","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(e.renderState(t.row))+"\n                ")]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"所属区域","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                    "+e._s(t.row.provinceName)+e._s(t.row.cityName)+"\n                ")]}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"siteName",label:"台站名称","min-width":"100",align:"center"}}),e._v(" "),l("el-table-column",{attrs:{label:"故障描述","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-popover",{attrs:{placement:"top-start",width:"200",trigger:"hover",content:t.row.declareContent}},[l("div",{staticStyle:{"text-overflow":"ellipsis","word-break":"normal"},attrs:{slot:"reference"},slot:"reference"},[e._v(e._s(t.row.declareContent))])])]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"视频","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.rowVideoDetail(t.row)}}},[e._v("详情")])]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"图片","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.rowPictureDetail(t.row)}}},[e._v("详情")])]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"执行人","min-width":"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{attrs:{type:"text"},on:{click:function(l){return e.rowEdit(t.row)}}},[t.row.executorName?[e._v(e._s(t.row.executorName))]:[e._v("未指派")]],2)]}}])}),e._v(" "),l("el-table-column",{attrs:{prop:"handleState",label:"处理进度","min-width":"100",align:"center"}})],1)],1),e._v(" "),l("div",{staticClass:"pagination"},[l("div",{staticClass:"placeholder"}),e._v(" "),l("el-pagination",{attrs:{background:"",layout:"prev, pager, next",total:e.tableTotal},on:{"current-change":e.tablePageChange}})],1),e._v(" "),l("z-img-view",{attrs:{imgs:e.fileList,visible:e.visible.pictureDetail},on:{"update:visible":function(t){return e.$set(e.visible,"pictureDetail",t)}}}),e._v(" "),l("el-dialog",{attrs:{title:"视频",visible:e.visible.videoDetail,width:"70%","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.visible,"videoDetail",t)},close:e.handleVideoClose}},[l("video",{ref:"videoPlayer",staticStyle:{width:"95%","margin-left":"2.5%"},attrs:{src:e.videoSrc,controls:"controls"}})]),e._v(" "),l("el-dialog",{attrs:{title:"添加",visible:e.visible.addDlg,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.visible,"addDlg",t)},opened:e.rowAddOpened,close:e.clearAddData}},[l("el-form",{ref:"addForm",attrs:{"label-width":"120px","label-position":"right",model:e.addForm,rules:e.addRules,size:"mini"}},[l("el-form-item",{attrs:{prop:"siteName",label:"申报人"}},[e._v("\n                "+e._s(e.username)+"\n            ")]),e._v(" "),l("el-form-item",{attrs:{prop:"siteAddress",label:"角色"}},[e._v("\n                "+e._s(e.role)+"\n            ")]),e._v(" "),l("el-form-item",{attrs:{prop:"contactsName",label:"联系人"}},[l("el-input",{model:{value:e.addForm.contactsName,callback:function(t){e.$set(e.addForm,"contactsName",t)},expression:"addForm.contactsName"}})],1),e._v(" "),l("el-form-item",{attrs:{prop:"phone",label:"电话"}},[l("el-input",{model:{value:e.addForm.phone,callback:function(t){e.$set(e.addForm,"phone",t)},expression:"addForm.phone"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"所属区域"}},[l("el-cascader",{attrs:{options:e.locationOptions,props:e.locationProps,placeholder:"请选择"},on:{change:e.siteListGet},model:{value:e.addForm.area,callback:function(t){e.$set(e.addForm,"area",t)},expression:"addForm.area"}})],1),e._v(" "),l("el-form-item",{attrs:{prop:"siteId",label:"台站名称"}},[l("el-select",{model:{value:e.addForm.siteId,callback:function(t){e.$set(e.addForm,"siteId",t)},expression:"addForm.siteId"}},e._l(e.siteOptions,function(e,t){return l("el-option",{key:t,attrs:{value:e.siteId,label:e.siteName}})}),1)],1),e._v(" "),l("el-form-item",{attrs:{prop:"declareType",label:"申报类型"}},[l("el-select",{model:{value:e.addForm.declareType,callback:function(t){e.$set(e.addForm,"declareType",t)},expression:"addForm.declareType"}},[l("el-option",{attrs:{value:"硬件问题",label:"硬件问题"}}),e._v(" "),l("el-option",{attrs:{value:"软件问题",label:"软件问题"}}),e._v(" "),l("el-option",{attrs:{value:"其他问题",label:"其他问题"}})],1)],1),e._v(" "),l("el-form-item",{attrs:{prop:"declareContent",label:"故障描述"}},[l("el-input",{attrs:{type:"textarea",maxlength:"9999","show-word-limit":""},model:{value:e.addForm.declareContent,callback:function(t){e.$set(e.addForm,"declareContent",t)},expression:"addForm.declareContent"}})],1)],1),e._v(" "),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.visible.addDlg=!1}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:e.rowAddSubmit}},[e._v("确 定")])],1)],1),e._v(" "),l("el-dialog",{attrs:{title:"指派",visible:e.visible.editDlg,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){return e.$set(e.visible,"editDlg",t)},close:e.clearEditData}},[l("el-form",{ref:"editForm",attrs:{"label-width":"120px","label-position":"right",model:e.editForm,rules:e.editRules,size:"mini"}},[l("el-form-item",{attrs:{label:"单号"}},[e._v("\n                "+e._s(e.editForm.declareId)+"\n            ")]),e._v(" "),l("el-form-item",{attrs:{label:"所属区域"}},[e._v("\n                "+e._s(e.editForm.provinceName)+"\n                "+e._s(e.editForm.cityName)+"\n            ")]),e._v(" "),l("el-form-item",{attrs:{label:"所属角色"}},[l("el-select",{attrs:{clearable:""},on:{change:e.personListGet},model:{value:e.editForm.roleId,callback:function(t){e.$set(e.editForm,"roleId",t)},expression:"editForm.roleId"}},e._l(e.roleOptions,function(e,t){return l("el-option",{key:t,attrs:{value:e.roleId,label:e.roleName}})}),1)],1),e._v(" "),l("el-form-item",{attrs:{label:"所属部门"}},[l("el-select",{attrs:{clearable:""},on:{change:e.personListGet},model:{value:e.editForm.departmentId,callback:function(t){e.$set(e.editForm,"departmentId",t)},expression:"editForm.departmentId"}},e._l(e.departmentOptions,function(e,t){return l("el-option",{key:t,attrs:{value:e.departmentId,label:e.departmentName}})}),1)],1),e._v(" "),l("el-form-item",{attrs:{prop:"executorId",label:"巡检人"}},[l("el-select",{attrs:{clearable:""},model:{value:e.editForm.executorId,callback:function(t){e.$set(e.editForm,"executorId",t)},expression:"editForm.executorId"}},e._l(e.personOptions,function(e,t){return l("el-option",{key:t,attrs:{value:e.adminId,label:e.fullName}})}),1)],1),e._v(" "),l("el-form-item",{attrs:{prop:"executionTime",label:"时间"}},[l("el-date-picker",{attrs:{"value-format":"yyyy-MM-dd hh:mm:ss",format:"yyyy-MM-dd"},model:{value:e.editForm.executionTime,callback:function(t){e.$set(e.editForm,"executionTime",t)},expression:"editForm.executionTime"}})],1)],1),e._v(" "),l("div",{attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.visible.editDlg=!1}}},[e._v("取 消")]),e._v(" "),l("el-button",{attrs:{type:"primary"},on:{click:e.rowEditSubmit}},[e._v("确 定")])],1)],1)],1)};a._withStripped=!0;var i={data:function(){return{tableData:null,tableParams:{parameter:null},tablePage:1,tableTotal:1,visible:{addDlg:!1,editDlg:!1,pictureDetail:!1,videoDetail:!1},addForm:{contactsName:null,phone:null,area:[],siteId:null,declareType:null,declareContent:null},addRules:{contactsName:[{required:!0,message:"请输入",trigger:"blur"}],phone:[{required:!0,message:"请输入",trigger:"blur"}],siteId:[{required:!0,message:"请选择",trigger:"change"}],declareType:[{required:!0,message:"请选择",trigger:"change"}],declareContent:[{required:!0,message:"请选择",trigger:"change"}]},editForm:{declareId:null,roleId:null,departmentId:null,executorId:null,executionTime:null},editRules:{executorId:[{required:!0,message:"请选择",trigger:"change"}],executionTime:[{required:!0,message:"请选择",trigger:"change"}]},locationOptions:[],locationProps:{value:"id",label:"name",children:"child"},siteOptions:[],roleOptions:[{roleName:"员工",roleId:29},{roleName:"代维1级",roleId:30},{roleName:"代维2级",roleId:31},{roleName:"办事处员工",roleId:34}],departmentOptions:[],personOptions:[],fileList:[],videoSrc:null}},computed:{username:function(){return JSON.parse(sessionStorage.getItem("adminInfo")).fullName},role:function(){return sessionStorage.getItem("role")}},methods:{tableListGet:function(){var e=this;this.$API.DeclareGet(this.tableParams.parameter?this.tableParams:null,this.tablePage).then(function(t){e.tableData=t.records,e.tableTotal=t.total})},personListGet:function(){var e=this;this.editForm.patrolId=null,this.$API.PersonGet(null,this.editForm.roleId||0,this.editForm.departmentId||0).then(function(t){e.personOptions=t})},siteListGet:function(){var e=this;this.$API.DeviceSiteGet(null,0,this.addForm.area[0]||0,this.addForm.area[1]||0).then(function(t){e.siteOptions=t})},rowAdd:function(){var e=this;this.$API.LocationGet().then(function(t){e.locationOptions=t}),this.visible.addDlg=!0},rowAddOpened:function(){this.$refs.addForm.resetFields()},rowAddSubmit:function(){var e=this;this.$refs.addForm.validate(function(t){if(t){var l={contactsName:e.addForm.contactsName||null,phone:e.addForm.phone||null,siteId:e.addForm.siteId||null,declareType:e.addForm.declareType||null,declareContent:e.addForm.declareContent||null};e.$API.DeclareAdd(l).then(function(){e.tableListGet(),e.visible.addDlg=!1})}})},rowEdit:function(e){var t=this;this.$API.DepartmentGet().then(function(e){t.departmentOptions=e}),this.editForm.declareId=e.declareId,this.editForm.provinceName=e.provinceName,this.editForm.cityName=e.cityName,this.editForm.executionTime=e.executionTime,this.visible.editDlg=!0},rowEditOpened:function(){this.$refs.editForm.resetFields()},rowEditSubmit:function(){var e=this;this.$refs.editForm.validate(function(t){if(t){var l={declareId:e.editForm.declareId,executorId:e.editForm.executorId,executionTime:e.editForm.executionTime};e.$API.DeclareEdit(l).then(function(){e.tableListGet(),e.visible.editDlg=!1})}})},rowPictureDetail:function(e){this.fileList=e.imgList.map(function(e){return e.resourceUrl}),this.visible.pictureDetail=!0},rowVideoDetail:function(e){for(var t=0;t<e.imgList.length;t++)if("申报视频"===e.imgList[t].resourceType){this.videoSrc=e.imgList[t].resourceUrl,this.visible.videoDetail=!0;break}this.videoSrc||this.$message({message:"未找到视频",type:"info"})},handleVideoClose:function(){this.$refs.videoPlayer.pause()},renderState:function(e){return e.siteGuaranteeTime},dateFormat:function(e,t,l,a){return this.$format(l)},clearAddData:function(){for(var e in this.addForm)this.addForm[e]="imgList"==e||"area"==e?[]:null},clearEditData:function(){for(var e in this.$refs.editForm.resetFields(),this.editForm)this.editForm[e]="imgList"==e||"area"==e?[]:null},tablePageChange:function(e){this.tablePage=e,this.tableListGet()}},mounted:function(){this.tableListGet()}},r=l(8),o=Object(r.a)(i,a,[],!1,null,null,null);o.options.__file="src/views/AfterSale/Declare.vue";t.default=o.exports}}]);